app.postpilot.in {
    log {
        output file /var/log/caddy/access.log
    }

    handle /api/* {

        reverse_proxy server:3001
        encode gzip
    }

    handle /* {
        reverse_proxy front:80
        encode gzip
        header {
            Cache-Control "public, max-age=31536000, immutable"
        }
    }

    tls {
        on_demand
    }

    @http host app.postpilot.in
    handle @http {
        redir https://{host}{uri}
    }
}